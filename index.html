<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ランク上げ 必要魔導石個数シミュレーター</title>
  <style>
    :root{
      --bg1:#f6f8ff;
      --bg2:#f3fbff;
      --card:#ffffffcc;
      --border:#d9e2ff;
      --text:#0f172a;
      --muted:#475569;
      --primary:#2563eb;
      --primary2:#1d4ed8;
      --danger:#b00020;
      --ok:#0f766e;
      --shadow: 0 10px 30px rgba(15,23,42,.08);
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family: system-ui, -apple-system, "Hiragino Sans", "Noto Sans JP", sans-serif;
      color:var(--text);
      background:
        radial-gradient(1200px 600px at 20% 10%, var(--bg2), transparent 60%),
        radial-gradient(1000px 600px at 80% 0%, var(--bg1), transparent 55%),
        linear-gradient(180deg, #f8fafc, #ffffff);
    }
    .wrap{
      max-width: 820px;
      margin: 0 auto;
      padding: 28px 18px 40px;
    }
    .titlebar{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:14px;
      margin-bottom: 14px;
    }
    h1{
      font-size: 22px;
      margin:0;
      letter-spacing: .2px;
    }
    .badge{
      font-size:12px;
      color:#1e3a8a;
      background:#dbeafe;
      border:1px solid #bfdbfe;
      padding:6px 10px;
      border-radius:999px;
      white-space:nowrap;
      margin-top:2px;
    }
    .card{
      background: var(--card);
      backdrop-filter: blur(8px);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 18px;
      box-shadow: var(--shadow);
    }
    .grid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 18px 18px;
      margin-top: 6px;
    }
    .field{
      padding: 10px;
      border-radius: 14px;
      background: #ffffff;
      border: 1px solid #e7ecff;
    }
    label{
      display:block;
      font-size: 12px;
      color: var(--muted);
      margin-bottom: 8px;
    }
    input, select{
      width:100%;
      padding: 12px 12px;
      border: 1px solid #cbd5e1;
      border-radius: 12px;
      font-size: 14px;
      outline: none;
      background:#fff;
    }
    input:focus, select:focus{
      border-color: #93c5fd;
      box-shadow: 0 0 0 4px rgba(59,130,246,.15);
    }
    .row{
      margin-top: 18px;
      display:flex;
      gap:12px;
      flex-wrap:wrap;
      align-items:center;
    }
    button{
      padding: 12px 14px;
      border:0;
      border-radius: 14px;
      font-size: 15px;
      cursor:pointer;
      font-weight: 650;
    }
    .btn{
      flex: 1 1 240px;
      background: linear-gradient(135deg, var(--primary), var(--primary2));
      color:#fff;
      box-shadow: 0 10px 22px rgba(37,99,235,.22);
    }
    .btn:hover{ filter: brightness(.98); }
    .btn:active{ transform: translateY(1px); }
    .meta{
      flex: 2 1 320px;
      font-size: 12px;
      color: var(--muted);
      line-height: 1.7;
      background: #f8fafc;
      border: 1px solid #e2e8f0;
      padding: 10px 12px;
      border-radius: 14px;
    }
    .warn{
      margin-top: 10px;
      color: var(--danger);
      font-size: 13px;
      font-weight: 650;
    }
    .result{
      margin-top: 16px;
      padding: 14px 14px;
      border-radius: 16px;
      background: linear-gradient(180deg, #ecfeff, #ffffff);
      border: 1px solid #a5f3fc;
    }
    .result h2{
      margin:0 0 10px;
      font-size: 15px;
      color: var(--ok);
    }
    .result p{ margin: 8px 0; }
    .mono{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Courier New", monospace;
    }
    @media (max-width: 720px){
      .grid{ grid-template-columns: 1fr; }
      .titlebar{ flex-direction:column; align-items:flex-start; }
      .badge{ align-self:flex-start; }
    }
  </style>
</head>
<body>
<div class="wrap">
  <div class="titlebar">
    <h1>ランク上げ 必要魔導石個数シミュレーター</h1>
    <div class="badge">スタミナ上限: <b class="mono">999</b> 固定</div>
  </div>

  <div class="card">
    <div class="grid">
      <div class="field">
        <label>現在のランク</label>
        <input id="nowRank" type="number" min="1" step="1" value="1" />
      </div>

      <div class="field">
        <label>目標のランク（4000以下）</label>
        <input id="goalRank" type="number" min="1" max="4000" step="1" value="2" />
      </div>

      <div class="field">
        <label>次のランクまでの必要経験値（残り）</label>
        <input id="needExp" type="number" min="0" step="1" value="5233779" />
      </div>

      <div class="field">
        <label>現在のスタミナ</label>
        <input id="nowStamina" type="number" min="0" max="999" step="1" value="500" />
      </div>

      <div class="field" style="grid-column: 1 / -1;">
        <label>周回するクエスト</label>
        <select id="whichQuest">
          <option value="0">エコロ（やる気 12 / 経験値 33480）</option>
          <option value="1">レガムント（やる気 15 / 経験値 38480）</option>
          <option value="2">経験値2倍 エコロ（やる気 12 / 経験値 66960）</option>
          <option value="3">経験値2倍 レガムント（やる気 15 / 経験値 76960）</option>
        </select>
      </div>
    </div>

    <div class="row">
      <button class="btn" id="calcBtn">計算する</button>
      <div class="meta">
        仕様：上限 999 / 石回復 +500 / ランクアップ回復 +500 /
        必要経験値は毎ランク 5233779 固定
      </div>
    </div>

    <div class="warn" id="warn"></div>

    <div class="result" id="result" style="display:none;">
      <h2>結果</h2>
      <p>必要な石の数：<b id="stoneOut"></b></p>
      <p>クエストクリア回数：<b id="questOut"></b></p>
      <p>最終スタミナ：<b id="staminaOut"></b></p>
      <p>次のランクまでに必要な経験値：<b id="needExpOut"></b></p>
      <p>到達ランク：<b id="rankOut"></b></p>
    </div>
  </div>
</div>

<script>
  const NEED_EXP_PER_RANK = 5233779;
  const RECOVER_AMOUNT = 500;
  const STAMINA_CAP = 999;
  const GOAL_RANK_MAX = 4000;

  // 4クエスト対応
  // 0: エコロ
  // 1: レガムント
  // 2: 2倍エコロ
  // 3: 2倍レガムント
  const EXP = [33480, 38480, 66960, 76960];
  const QUEST_STAMINA = [12, 15, 12, 15];

  function clamp(n, min, max) {
    return Math.max(min, Math.min(n, max));
  }
  function toInt(v) {
    const n = Number(v);
    return Number.isFinite(n) ? Math.trunc(n) : NaN;
  }

  const nowRankInput = document.getElementById("nowRank");
  const needExpInput = document.getElementById("needExp");

  function syncNeedExpIfMaxRank() {
    const r = toInt(nowRankInput.value);
    if (!Number.isNaN(r) && r >= 4000) {
      needExpInput.value = 0;
    }
  }
  nowRankInput.addEventListener("input", syncNeedExpIfMaxRank);
  syncNeedExpIfMaxRank();

  document.getElementById("calcBtn").addEventListener("click", () => {
    const warnEl = document.getElementById("warn");
    warnEl.textContent = "";
    document.getElementById("result").style.display = "none";

    let nowRank = toInt(nowRankInput.value);
    let goalRank = toInt(document.getElementById("goalRank").value);
    let needExp = toInt(needExpInput.value);
    let nowStamina = toInt(document.getElementById("nowStamina").value);
    const whichQuest = toInt(document.getElementById("whichQuest").value);

    if ([nowRank, goalRank, needExp, nowStamina, whichQuest].some(n => Number.isNaN(n))) {
      warnEl.textContent = "入力が不正です。";
      return;
    }
    if (nowRank < 1) {
      warnEl.textContent = "現在のランクは1以上で入力してください。";
      return;
    }
    if (goalRank < 1) {
      warnEl.textContent = "目標ランクは1以上で入力してください。";
      return;
    }
    if (goalRank > GOAL_RANK_MAX) {
      warnEl.textContent = "目標ランクが4001以上です。4000以下で入力してください。";
      return;
    }
    if (goalRank < nowRank) {
      warnEl.textContent = "目標ランクは現在ランク以上にしてください。";
      return;
    }
    if (needExp < 0) {
      warnEl.textContent = "必要経験値（残り）は0以上で入力してください。";
      return;
    }

    nowStamina = clamp(nowStamina, 0, STAMINA_CAP);

    let stoneCounter = 0;
    let questClear = 0;

    while (nowRank < goalRank) {
      while (needExp > 0) {
        if (nowStamina < QUEST_STAMINA[whichQuest]) {
          stoneCounter++;
          nowStamina = Math.min(nowStamina + RECOVER_AMOUNT, STAMINA_CAP);
          continue;
        }
        nowStamina -= QUEST_STAMINA[whichQuest];
        needExp -= EXP[whichQuest];
        questClear++;
      }

      nowRank++;
      needExp += NEED_EXP_PER_RANK;
      nowStamina = Math.min(nowStamina + RECOVER_AMOUNT, STAMINA_CAP);
    }

    if (nowRank >= 4000) {
      needExp = 0;
    }

    document.getElementById("stoneOut").textContent = stoneCounter + " 個";
    document.getElementById("questOut").textContent = questClear + " 回";
    document.getElementById("staminaOut").textContent = nowStamina;
    document.getElementById("needExpOut").textContent = needExp;
    document.getElementById("rankOut").textContent = nowRank;

    document.getElementById("result").style.display = "block";
  });
</script>
</body>
</html>